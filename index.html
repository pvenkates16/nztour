<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Zealand Tour Itinerary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- CORE STYLES --- */
        body { 
            font-family: 'Inter', sans-serif; 
            /* Scenic Gradient Background (Mimics NZ Lake/Glacier colors) */
            background: linear-gradient(180deg, #d4f2ff 0%, #38bdf8 45%, #0e7490 100%);
            background-attachment: fixed;
            min-height: 100vh; 
            position: relative; 
        }
        
        /* Remove the problematic image/overlay styles */
        body::before {
            content: none !important; 
        }

        /* * CRITICAL CHANGE: Semi-Translucent Content Cards *
         * Background color is set to 85% opaque white (rgba(255, 255, 255, 0.85)) 
         * to allow the 3D background to show through slightly.
         */
        .content-card-bg {
            background-color: rgba(255, 255, 255, 0.85); 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            position: relative;
            z-index: 10;
        }
        
        /* Apply 85% opacity to the tab content panel as well (was solid white) */
        #tab-content {
            background-color: rgba(255, 255, 255, 0.85); 
        }
        
        /* Apply 85% opacity to the tab navigation panel as well (was solid white) */
        #tab-nav {
            background-color: rgba(255, 255, 255, 0.85);
        }

        .hero-bg {
            /* Using a scenic placeholder image URL */
            background-image: url('https://img.freepik.com/free-photo/landscape-lake-pukaki-pukaki-new-zealand-surrounded-with-snowy-mountains_181624-26720.jpg?semt=ais_hybrid&w=740&q=80');
            background-size: cover;
            background-position: center;
            border-bottom-left-radius: 3rem;
            border-bottom-right-radius: 3rem;
            z-index: 10;
        }
        
        .tour-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .tour-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        /* Custom styles for the tabbed content for continuity */
        .timeline-item {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 2.5rem;
            border-left: 2px solid #38bdf8; /* Sky blue timeline */
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #0e7490; /* Darker teal dot */
            border: 3px solid #f7fafc;
        }
        .excursion-content:not([data-excursion-for="Overview"]) {
            display: none; /* Hide all excursion content except Overview by default (JS will manage visibility) */
        }
        .meal-status {
            font-weight: 600;
        }
        .meal-status.booked {
            color: #059669; /* Emerald green (Confirmed) */
        }
        .meal-status.tbd {
            color: #d97706; /* Amber orange (Suggested/TBD) */
        }

        /* --- THREE.JS SPECIFIC STYLES --- */
        #threejs-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10; /* Important: Ensures it sits behind all content */
        }
        
        /* Chatbot Specific Styles for Container and Toggle */
        #chatbot-wrapper {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        #chat-window {
            width: 350px; /* Slightly wider window */
            height: 450px; /* Slightly taller window */
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            transition: transform 0.3s ease, opacity 0.3s ease;
            transform: translateY(10px);
            opacity: 0;
            pointer-events: none; /* Invisible when closed */
            /* FIX: Increased margin to provide clearance for the chat input/send button */
            margin-bottom: 50px; 
        }
        #chat-window.open {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto; /* Interactive when open */
        }
        #chat-toggle-btn {
            background-color: #0e7490;
            color: white;
            padding: 1rem;
            border-radius: 9999px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        #chat-toggle-btn:hover {
            background-color: #06b6d4;
            transform: scale(1.05);
        }
        #chat-window-header {
            background-color: #0e7490;
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
        }

        /* --- MAP SPECIFIC STYLES --- */
        #map-svg-container {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            height: 700px;
            background-color: #e0f2fe;
        }
        #map-svg {
            width: 100%;
            height: 100%;
            position: relative; /* SVG needed for z-index */
            z-index: 1;
        }
        .stay-point, .transit-line, .excursion-line, .excursion-point, .flight-line {
            transition: all 0.2s ease-in-out; 
            cursor: pointer;
        }
        
        .stay-point {
            /* Fill is set by D3 to use a gradient URL, not a solid color */
            stroke: #b91c1c; /* Softened red stroke */
            stroke-width: 2;
        }
        .stay-point:hover {
            filter: brightness(1.2); 
        }
        .transit-line {
            stroke: #2563eb; /* Blue */
            stroke-width: 3;
            fill: none;
        }
        .transit-line:hover {
            filter: brightness(1.2);
        }
        .excursion-line {
            stroke: #10b981; /* Green */
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 4 2;
        }
        .excursion-line:hover {
            filter: brightness(1.2);
        }
        .excursion-point {
            /* Fill is set by D3 to use a gradient URL, not a solid color */
            stroke: #059669; /* Darker green stroke */
            stroke-width: 2;
        }
        .excursion-point:hover {
            filter: brightness(1.2);
        }
        .flight-line {
            stroke: #6b7280; /* Grey */
            stroke-width: 4;
            fill: none;
            stroke-dasharray: 8 4;
        }
        .flight-line:hover {
            filter: brightness(1.2);
        }

        /* --- INFO PANEL STYLES --- */
        #info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 280px;
            background-color: rgba(255, 255, 255, 0.85); 
            border: 2px solid #0e7490;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 10; /* Above the SVG */
            font-size: 0.875rem;
            line-height: 1.4;
            max-height: 90%;
            overflow-y: auto;
        }
        #info-panel h4 {
            font-weight: bold;
            font-size: 1.1rem;
            color: #0e7490;
            margin-bottom: 0.5rem;
        }
        #info-panel p {
            color: #1f2937;
        }

    </style>
</head>
<body class="antialiased">

    <div id="threejs-background"></div>

    <header class="hero-bg py-24 text-white">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-5xl font-bold mb-2">Aotearoa: 14-Day New Zealand Tour</h1>
            <p class="text-xl font-light">From the Southern Alps to Geothermal Rotorua | Dec 11 - 26, 2025</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12">

        <section class="mb-16">
            <h2 class="text-3xl font-bold mb-8 text-gray-800">Tour Details & Day-by-Day Itinerary</h2>

            <div id="tab-nav" class="flex flex-wrap border-b border-gray-200 -mb-px content-card-bg">
                <button data-tab-target="Overview" class="tab-button inline-block p-4 border-b-2 border-transparent rounded-t-lg text-gray-500 hover:text-cyan-600 hover:border-cyan-300 transition duration-150 text-sm md:text-base">Tour Overview</button>
                <button data-tab-target="TourMap" class="tab-button inline-block p-4 border-b-2 border-transparent rounded-t-lg text-gray-500 hover:text-cyan-600 hover:border-cyan-300 transition duration-150 text-sm md:text-base">Tour Map</button>
                <button data-tab-target="Christchurch" class="tab-button inline-block p-4 border-b-2 border-transparent rounded-t-lg text-gray-500 hover:text-cyan-600 hover:border-cyan-300 transition duration-150 text-sm md:text-base">Christchurch (3 Nights)</button>
                <button data-tab-target="LakeTekapo" class="tab-button inline-block p-4 border-b-2 border-transparent rounded-t-lg text-gray-500 hover:text-cyan-600 hover:border-cyan-300 transition duration-150 text-sm md:text-base">Lake Tekapo (1 Night)</button>
                <button data-tab-target="MountCook" class="tab-button inline-block p-4 border-b-2 border-transparent rounded-t-lg text-gray-500 hover:text-cyan-600 hover:border-cyan-300 transition duration-150 text-sm md:text-base">Mt Cook (2 Nights)</button>
                <button data-tab-target="Queenstown" class="tab-button inline-block p-4 border-b-2 border-transparent rounded-t-lg text-gray-500 hover:text-cyan-600 hover:border-cyan-300 transition duration-150 text-sm md:text-base">Queenstown (3 Nights)</button>
                <button data-tab-target="TeAnau" class="tab-button inline-block p-4 border-b-2 border-transparent rounded-t-lg text-gray-500 hover:text-cyan-600 hover:border-cyan-300 transition duration-150 text-sm md:text-base">Te Anau (2 Nights)</button>
                <button data-tab-target="Rotorua" class="tab-button inline-block p-4 border-b-2 border-transparent rounded-t-lg text-gray-500 hover:text-cyan-600 hover:border-cyan-300 transition duration-150 text-sm md:text-base">Rotorua (2 Nights)</button>
                <button data-tab-target="Auckland" class="tab-button inline-block p-4 border-b-2 border-transparent rounded-t-lg text-gray-500 hover:text-cyan-600 hover:border-cyan-300 transition duration-150 text-sm md:text-base">Auckland (2 Nights)</button>
            </div>

            <div id="tab-content" class="p-6 content-card-bg rounded-b-xl shadow-xl border-t-2 border-gray-200">
                
                <div data-tab-content="Overview" class="tab-content hidden">
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <h2 class="text-3xl font-bold mb-4 text-gray-800">Aotearoa: History of Settlement</h2>
                        <p class="text-gray-600 mb-6">
                            New Zealand (Aotearoa) and Australia have distinct settlement histories. New Zealand was one of the last habitable lands to be settled by humans, with Polynesians (who developed into the Māori culture) arriving in ocean-going canoes (`waka`) between **1250 and 1300 CE**. The discovery was a planned and deliberate event that occurred over several decades.
                        </p>
                        <p class="text-gray-600 mb-6">
                            In contrast, Australia's Indigenous history stretches back much further, with Aboriginal Australians arriving from Indonesia or New Guinea around **50,000 to 65,000 years ago**.
                        </p>
                        <h3 class="text-xl font-semibold mb-3 text-gray-700">Reasons for Migration to Aotearoa (NZ) and Australia</h3>
                        <div class="space-y-3 text-gray-600 mb-6">
                            <p>
                                <span class="font-medium text-cyan-600">Polynesians (Māori ancestors) to NZ:</span> These initial migrations were **planned voyages of exploration** driven by **curiosity, prestige, or a spirit of adventure** to find new lands. They sought a **vast, resource-rich land** with abundant wildlife (like the Moa) and forests, or were looking for a better life away from pressures in their tropical homelands.
                            </p>
                            <p>
                                <span class="font-medium text-cyan-600">Aboriginal Ancestors to Australia:</span> The ancestors of Aboriginal Australians arrived as part of the **single "Out of Africa" migration wave** of modern humans, migrating along the Southern Route to explore the continent when **lower sea levels created land bridges** connecting Asia and Australia.
                            </p>
                            <p>
                                <span class="font-medium text-cyan-600">English/Europeans (Pākehā) to NZ:</span> Settlers aimed to create a **"better Britain,"** free from the poverty and rigid class system of the UK. A major draw was the **prospect of owning land**, which was inaccessible to many in the UK, and the belief that the temperate climate would be **good for their families' health**. Early arrivals also included whalers, sealers, and missionaries.
                            </p>
                            <p>
                                <span class="font-medium text-cyan-600">English/Europeans to Australia:</span> The initial 1788 settlement was established as a **penal colony to relieve overcrowded British prisons** and serve as a **strategic British naval base** in the Southern Hemisphere. Later waves of free settlers were primarily motivated by **economic opportunities** such as gold rushes, mineral mining, and wool farming.
                            </p>
                        </div>
                        
                        <h3 class="text-xl font-semibold mb-3 text-gray-700">A Tale of Two Colonies: NZ vs. Australia</h3>
                        <div class="space-y-3 text-gray-600">
                            <p>
                                <span class="font-medium text-cyan-600">Indigenous History:</span> Māori were agriculturalists with strong warrior traditions, capable of organized resistance. Aboriginal Australians were primarily hunter-gatherers.
                            </p>
                            <p>
                                <span class="font-medium text-cyan-600">Colonial Foundation:</span> Australia was founded in 1788 as a penal colony (New South Wales), based on the legal concept of *Terra Nullius* (land belonging to no one). New Zealand's foundation was dramatically different, secured in 1840 through the **Treaty of Waitangi** (`Te Tiriti o Waitangi`) between the British Crown and Māori chiefs, guaranteeing certain rights in exchange for sovereignty.
                            </p>
                            <p>
                                <span class="font-medium text-cyan-600">Settler Class:</span> Early Australian settlers included large numbers of lower-class immigrants and convicts. New Zealand tended to attract a different class of settler, often associated with commercially organized settlement companies and more middle-class religious groups.
                            </p>
                        </div>
                    </div>
                </div>

                <div data-tab-content="TourMap" class="tab-content hidden">
                    <h2 class="text-3xl font-bold mb-4 text-gray-800">Visualizing the 14-Day Journey</h2>
                    <p class="text-gray-600 mb-6">Click on any **Red Circle (Stay)**, **Blue Line (Transit)**, or **Green Element (Excursion)** to view details in the panel below.</p>
                    
                    <div id="map-svg-container" class="map-container">
                        <div id="info-panel">
                            <h4>Tour Information</h4>
                            <p id="info-content">Click an element on the map to see details about the stay, transit, or excursion.</p>
                        </div>
                    </div>
                </div>
                
                <div data-tab-content="Christchurch" class="tab-content hidden">
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg flex flex-col md:flex-row items-start space-y-3 md:space-y-0 md:space-x-4 border border-gray-200">
                        <img src="https://placehold.co/200x100/38bdf8/ffffff?text=Sudima+Chch" alt="Sudima Christchurch City exterior" class="w-full md:w-48 h-auto md:h-24 object-cover rounded-md shadow-md">
                        <div>
                            <h4 class="font-semibold text-lg text-gray-800">Accommodation: Sudima Christchurch City</h4>
                            <p class="text-sm text-gray-600 mb-2">49 Salisbury Street, Christchurch City. Check-in details available from your tour guide.</p>
                            <a href="https://www.sudimahotels.com/en/hotels/christchurch-city/" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium text-sm transition duration-150">View Sudima Christchurch City →</a>
                        </div>
                    </div>
                    <div class="space-y-8">
                        <div class="timeline-item">
                            <h3 class="text-xl font-bold text-cyan-700">Christchurch, The Garden City</h3>
                            <p class="text-sm text-gray-500 mb-4">Days 1-3</p>
                            <ul class="list-none space-y-3 text-gray-700">
                                <li><span class="font-semibold">Day 1 (Arrival):</span> Arrival via private transfer and check-in. Explore the vibrant city center independently.</li>
                                <li><span class="font-semibold">Day 2 (City Exploration):</span> <span class="text-blue-600">Christchurch Tram Pass.</span> Use your hop-on/hop-off ticket to visit the botanical gardens, museums, and the historic Arts Centre.</li>
                                <li><span class="font-semibold">Day 3 (Kaikoura Excursion):</span> Morning drive to Kaikoura for a day trip. Scheduled: <span class="text-blue-600">Whale Watch Cruise Kaikoura.</span> Look out for majestic Sperm Whales, seals, and dolphins. Return to Christchurch in the evening.</li>
                            </ul>
                        </div>
                        
                        <div class="p-4 bg-white border border-gray-200 rounded-lg">
                            <h4 class="font-bold text-lg mb-2 text-gray-800">Dining Reservations</h4>
                            <ul class="list-none space-y-2 text-sm">
                                <li><span class="font-semibold text-gray-700">Day 1 (Dec 11):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">TBD (Arrival Day)</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Suggestions: INATI - Fine Dining/NZ Produce, The Monday Room - Modern NZ/European, Zodiac Bar - Modern Asian, Himalayas Indian)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 2 (Dec 12):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Sudima</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Suggestions: INATI - Fine Dining/NZ Produce, The Monday Room - Modern NZ/European, Soul Quarter - Modern NZ/French, Mumbaiwala Indian Street Food)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 3 (Dec 13):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Sudima</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (En route or independent)</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Suggestions: INATI - Fine Dining/NZ Produce, The Monday Room - Modern NZ/European, The Goldfinch - European/Asian, Royal Tandoor)</span></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div data-tab-content="LakeTekapo" class="tab-content hidden">
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg flex flex-col md:flex-row items-start space-y-3 md:space-y-0 md:space-x-4 border border-gray-200">
                        <img src="https://placehold.co/200x100/38bdf8/ffffff?text=Grand+Suites+Tekapo" alt="Grand Suites Lake Tekapo exterior" class="w-full md:w-48 h-auto md:h-24 object-cover rounded-md shadow-md">
                        <div>
                            <h4 class="font-semibold text-lg text-gray-800">Accommodation: Grand Suites Lake Tekapo</h4>
                            <p class="text-sm text-gray-600 mb-2">14 Greig Street, Lake Tekapo. Breakfast booked at The Godley Hotel Tasman Room (Day 5).</p>
                            <a href="https://grandsuitestekapo.co.nz/" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium text-sm transition duration-150">View Grand Suites Lake Tekapo →</a>
                        </div>
                    </div>
                    <div class="space-y-8">
                        <div class="timeline-item">
                            <h3 class="text-xl font-bold text-cyan-700">Lake Tekapo, Dark Sky Reserve</h3>
                            <p class="text-sm text-gray-500 mb-4">Day 4</p>
                            <ul class="list-none space-y-3 text-gray-700">
                                <li><span class="font-semibold">Activities:</span> Morning <span class="text-blue-600">TranzAlpine Train Journey</span> (Christchurch to Arthur's Pass). Guide transfer from Arthur's Pass, driving through the dramatic Southern Alps scenery (Castle Hill).</li>
                                <li><span class="font-semibold">Evening:</span> <span class="text-blue-600">Summit Experience Stargazing Tour</span> at the UNESCO Dark Sky Reserve. Visit the iconic Church of the Good Shepherd.</li>
                            </ul>
                        </div>
                        
                        <div class="p-4 bg-white border border-gray-200 rounded-lg">
                            <h4 class="font-bold text-lg mb-2 text-gray-800">Dining Reservations</h4>
                            <ul class="list-none space-y-2 text-sm">
                                <li><span class="font-semibold text-gray-700">Day 4 (Dec 14):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Sudima (Christchurch)</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (En route near Geraldine)</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Suggestions: Ramen Tekapo - Japanese/Asian Fusion, Dark Sky Diner - NZ/International, Dolce Pizza - Pizza/Italian, Blue Lake Eatery & Bar)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 5 (Dec 15, Departure):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at The Godley Hotel (Tasman Room, 8:25 AM)</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (En route to Mt Cook)</span></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div data-tab-content="MountCook" class="tab-content hidden">
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg flex flex-col md:flex-row items-start space-y-3 md:space-y-0 md:space-x-4 border border-gray-200">
                        <img src="https://placehold.co/200x100/38bdf8/ffffff?text=Hermitage+Mt+Cook" alt="The Hermitage Hotel Mount Cook exterior" class="w-full md:w-48 h-auto md:h-24 object-cover rounded-md shadow-md">
                        <div>
                            <h4 class="font-semibold text-lg text-gray-800">Accommodation: The Hermitage Hotel Mount Cook</h4>
                            <p class="text-sm text-gray-600 mb-2">Terrace Road, Aoraki Mt Cook. Dinner reservations at Alpine Restaurant (buffet).</p>
                            <a href="https://www.hermitage.co.nz/" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium text-sm transition duration-150">View The Hermitage Hotel →</a>
                        </div>
                    </div>
                    <div class="space-y-8">
                        <div class="timeline-item">
                            <h3 class="text-xl font-bold text-cyan-700">Mount Cook Village, Aoraki/Mt Cook</h3>
                            <p class="text-sm text-gray-500 mb-4">Days 5-6</p>
                            <ul class="list-none space-y-3 text-gray-700">
                                <li><span class="font-semibold">Day 5 (Alpine Views):</span> Scenic drive past Lake Pukaki. Afternoon: <span class="text-blue-600">Aoraki/Mt Cook Ultimate Helicopter Flight</span>, circling the summit and including a snow landing on Tasman Glacier.</li>
                                <li><span class="font-semibold">Day 6 (Glacier Exploration):</span> Morning: <span class="text-blue-600">Glacier Explorers Tour.</span> Boat trip on the Tasman Glacial Lake to see icebergs (Note: Requires a 1.5km walk). Afternoon free for short, well-marked walks (e.g., Kea Point, Red Tarns).</li>
                            </ul>
                        </div>

                        <div class="p-4 bg-white border border-gray-200 rounded-lg">
                            <h4 class="font-bold text-lg mb-2 text-gray-800">Dining Reservations</h4>
                            <ul class="list-none space-y-2 text-sm">
                                <li><span class="font-semibold text-gray-700">Day 5 (Dec 15):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Godley Hotel (Tekapo)</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Suggestion: Independent/Cafe Stop En Route)</span></li>
                                        <li>Dinner: <span class="meal-status booked">Alpine Restaurant Buffet (6:00 PM)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 6 (Dec 16):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid Fully Cooked at Hermitage</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Suggestion: Independent/Cafe Stop at Hermitage)</span></li>
                                        <li>Dinner: <span class="meal-status booked">Alpine Restaurant Buffet (7:00 PM)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 7 (Dec 17, Departure):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid Fully Cooked at Hermitage</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Suggestion: Independent/Cafe Stop En Route)</span></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div data-tab-content="Queenstown" class="tab-content hidden">
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg flex flex-col md:flex-row items-start space-y-3 md:space-y-0 md:space-x-4 border border-gray-200">
                        <img src="https://placehold.co/200x100/38bdf8/ffffff?text=Central+Private+Qt" alt="The Central Private Hotel exterior" class="w-full md:w-48 h-auto md:h-24 object-cover rounded-md shadow-md">
                        <div>
                            <h4 class="font-semibold text-lg text-gray-800">Accommodation: The Central Private Hotel by Naumi Hotels</h4>
                            <p class="text-sm text-gray-600 mb-2">4 Sydney Street, Queenstown. Includes daily breakfast and complimentary happy hour (5-6pm).</p>
                            <a href="https://www.naumihotels.com/the-central-hotel-queenstown-a-naumi-chapter" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium text-sm transition duration-150">View The Central Private Hotel →</a>
                        </div>
                    </div>
                    <div class="space-y-8">
                        <div class="timeline-item">
                            <h3 class="text-xl font-bold text-cyan-700">Queenstown, The Adventure Capital</h3>
                            <p class="text-sm text-gray-500 mb-4">Days 7-9</p>
                            <ul class="list-none space-y-3 text-gray-700">
                                <li><span class="font-semibold">Day 7 (Arrival & Cruise):</span> Drive through Lindis Pass and Central Otago (stop at Cromwell for fruit). Evening: <span class="text-blue-600">TSS Earnslaw Cruise and Walter Peak High Country Gourmet Dinner.</span></li>
                                <li><span class="font-semibold">Day 8 (Guide Rest Day):</span> Independent: <span class="text-blue-600">Central Otago Gourmet Food & Wine Tour</span> (visiting multiple sub-regions, wine cave tour, and unique lunch).</li>
                                <li><span class="font-semibold">Day 9 (Wanaka Excursion):</span> Drive over Crown Range to Wanaka. Explore 'That Wanaka Tree', Cardrona Hotel/Distillery, or the lakefront. Return to Queenstown.</li>
                            </ul>
                        </div>

                        <div class="p-4 bg-white border border-gray-200 rounded-lg">
                            <h4 class="font-bold text-lg mb-2 text-gray-800">Dining Reservations</h4>
                            <ul class="list-none space-y-2 text-sm">
                                <li><span class="font-semibold text-gray-700">Day 7 (Dec 17):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Hermitage (Mt Cook)</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (En route)</span></li>
                                        <li>Dinner: <span class="meal-status booked">Walter Peak High Country Gourmet Dinner</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 8 (Dec 18):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Hotel Naumi (Continental)</span></li>
                                        <li>Lunch: <span class="meal-status booked">Included with Central Otago Wine Tour</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Suggestions: Nest Restaurant - Fine Dining/NZ Produce, My Thai Lounge, Blue Kanu Asian Fusion, The Taj Indian Kitchen)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 9 (Dec 19):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Hotel Naumi (Continental)</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Suggestion: Independent/Cafe in Wanaka)</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Suggestions: Nest Restaurant - Fine Dining/NZ Produce, Yonder, Blue Kanu Asian Fusion, The Taj Indian Kitchen)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 10 (Dec 20, Departure):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Hotel Naumi (Continental)</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Suggestion: Independent/Cafe En Route to Te Anau)</span></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div data-tab-content="TeAnau" class="tab-content hidden">
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg flex flex-col md:flex-row items-start space-y-3 md:space-y-0 md:space-x-4 border border-gray-200">
                        <img src="https://placehold.co/200x100/38bdf8/ffffff?text=Fiordland+Motel+Te+Anau" alt="Fiordland Lakeview Motel exterior" class="w-full md:w-48 h-auto md:h-24 object-cover rounded-md shadow-md">
                        <div>
                            <h4 class="font-semibold text-lg text-gray-800">Accommodation: Fiordland Lakeview Motel & Apartments</h4>
                            <p class="text-sm text-gray-600 mb-2">42 Lakefront Drive, Te Anau. Breakfast booked at Distinction Te Anau Hotel & Villas.</p>
                            <a href="https://fiordlandlakeview.co.nz/" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium text-sm transition duration-150">View Fiordland Lakeview Motel →</a>
                        </div>
                    </div>
                    <div class="space-y-8">
                        <div class="timeline-item">
                            <h3 class="text-xl font-bold text-cyan-700">Te Anau & Milford Sound</h3>
                            <p class="text-sm text-gray-500 mb-4">Days 10-11</p>
                            <ul class="list-none space-y-3 text-gray-700">
                                <li><span class="font-semibold">Day 10 (Glowworms):</span> Drive from Queenstown. Afternoon: <span class="text-blue-600">Te Anau Glowworm Caves Tour</span> (cruise across Lake Te Anau, underground waterfall, and glowworm grotto).</li>
                                <li><span class="font-semibold">Day 11 (Fiordland):</span> Day trip drive on the scenic Milford Road (allow 2.5hrs each way). Scheduled: <span class="text-blue-600">Milford Sound Nature Cruise.</span></li>
                            </ul>
                        </div>

                        <div class="p-4 bg-white border border-gray-200 rounded-lg">
                            <h4 class="font-bold text-lg mb-2 text-gray-800">Dining Reservations</h4>
                            <ul class="list-none space-y-2 text-sm">
                                <li><span class="font-semibold text-gray-700">Day 10 (Dec 20):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Hotel Naumi (Queenstown)</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (En route/Te Anau)</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Suggestions: The Redcliff - Fine Dining/Seasonal Veg, The Fat Duck - Gastropub/Vegan Menu, Thai Anau Restaurant, Radha's Indian Restaurant)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 11 (Dec 21):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Distinction Te Anau Hotel (7:45 AM)</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Suggestion: Packed lunch/Snacks for Cruise)</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Suggestions: The Redcliff - Fine Dining/Seasonal Veg, The Fat Duck - Gastropub/Vegan Menu, Ristorante Pizzeria Paradiso Da Toni - Italian, Ditto Asian-Inspired)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 12 (Dec 22, Departure):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Distinction Te Anau Hotel (7:45 AM)</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Suggestion: Independent/Cafe near Queenstown Airport)</span></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div data-tab-content="Rotorua" class="tab-content hidden">
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg flex flex-col md:flex-row items-start space-y-3 md:space-y-0 md:space-x-4 border border-gray-200">
                        <img src="https://placehold.co/200x100/38bdf8/ffffff?text=Pullman+Rotorua" alt="Pullman Hotel Rotorua exterior" class="w-full md:w-48 h-auto md:h-24 object-cover rounded-md shadow-md">
                        <div>
                            <h4 class="font-semibold text-lg text-gray-800">Accommodation: Pullman Hotel Rotorua</h4>
                            <p class="text-sm text-gray-600 mb-2">1135 Arawa Street, Rotorua. A contemporary hotel in the heart of the city.</p>
                            <a href="https://www.pullmanrotorua.com/" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium text-sm transition duration-150">View Pullman Hotel Rotorua →</a>
                        </div>
                    </div>
                    <div class="space-y-8">
                        <div class="timeline-item">
                            <h3 class="text-xl font-bold text-cyan-700">Rotorua, Geothermal Heartland</h3>
                            <p class="text-sm text-gray-500 mb-4">Days 12-13</p>
                            <ul class="list-none space-y-3 text-gray-700">
                                <li><span class="font-semibold">Day 12 (Travel Day):</span> Morning drive back to Queenstown. Domestic Flight: <span class="text-blue-600">Queenstown to Rotorua.</span> Check-in to hotel.</li>
                                <li><span class="font-semibold">Day 13 (Culture & Wellness):</span> Morning: <span class="text-blue-600">Redwoods Treewalk.</span> Afternoon: <span class="text-blue-600">Restorative Journey</span> (Wai Ariki Hot Springs and Spa). Evening: <span class="text-blue-600">Te Pō Māori Cultural Experience + Hāngī Dinner.</span></li>
                            </ul>
                        </div>

                        <div class="p-4 bg-white border border-gray-200 rounded-lg">
                            <h4 class="font-bold text-lg mb-2 text-gray-800">Dining Reservations</h4>
                            <ul class="list-none space-y-2 text-sm">
                                <li><span class="font-semibold text-gray-700">Day 12 (Dec 22):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Distinction Te Anau Hotel</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Queenstown/Airport)</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Suggestions: The Mains Restaurant - Fine Dining/NZ Produce, BailwalG Pure Vegetarian - Indian, Chimney Indian Restaurant, Silk Road All You Can Eat - International/Asian Fusion)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 13 (Dec 23):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Pullman Rotorua</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Suggestion: Independent/Cafe near Wai Ariki Hot Springs)</span></li>
                                        <li>Dinner: <span class="meal-status booked">Te Pō Māori Cultural Experience (Hāngī Dinner)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 14 (Dec 24, Departure):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Pullman Rotorua</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Suggestion: Independent/Cafe En Route to Auckland)</span></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div data-tab-content="Auckland" class="tab-content hidden">
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg flex flex-col md:flex-row items-start space-y-3 md:space-y-0 md:space-x-4 border border-gray-200">
                        <img src="https://placehold.co/200x100/38bdf8/ffffff?text=Horizon+SkyCity+Akl" alt="Horizon by SkyCity exterior" class="w-full md:w-48 h-auto md:h-24 object-cover rounded-md shadow-md">
                        <div>
                            <h4 class="font-semibold text-lg text-gray-800">Accommodation: Horizon by SkyCity</h4>
                            <p class="text-sm text-gray-600 mb-2">85 Hobson Street, Auckland. Located near the iconic Sky Tower.</p>
                            <a href="https://horizonbyskycity.skycityauckland.co.nz/" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium text-sm transition duration-150">View Horizon by SkyCity →</a>
                        </div>
                    </div>
                    <div class="space-y-8">
                        <div class="timeline-item">
                            <h3 class="text-xl font-bold text-cyan-700">Auckland, City of Sails</h3>
                            <p class="text-sm text-gray-500 mb-4">Days 14-16</p>
                            <ul class="list-none space-y-3 text-gray-700">
                                <li><span class="font-semibold">Day 14 (Arrival):</span> Drive from Rotorua to Auckland. Check-in and explore the city's waterfront (Viaduct Basin, Federal Street dining).</li>
                                <li><span class="font-semibold">Day 15 (Independent):</span> Independent Day. Suggested: Take a ferry to Waiheke Island (wineries/beaches), or explore Queen Street for shopping.</li>
                                <li><span class="font-semibold">Day 16 (Departure):</span> Morning departure from Auckland Airport via private transfer.</li>
                            </ul>
                        </div>
                        
                        <div class="p-4 bg-white border border-gray-200 rounded-lg">
                            <h4 class="font-bold text-lg mb-2 text-gray-800">Dining Reservations</h4>
                            <ul class="list-none space-y-2 text-sm">
                                <li><span class="font-semibold text-gray-700">Day 14 (Dec 24):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Pullman Rotorua</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (En route/Auckland)</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Suggestions: Ahi - Fine Dining/NZ Produce, East - Modern Asian Eatery, Forest - Vegetarian Fine Dining, Orbit 360° Dining)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 15 (Dec 25):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Horizon by SkyCity</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Christmas Day - Suggestions: Orbit 360° Dining - Christmas Menu, Ahi, Khu Khu Eatery - Vegan Thai, East - Modern Asian Eatery)</span></li>
                                        <li>Dinner: <span class="meal-status tbd">TBD (Christmas Day - Suggestions: Orbit 360° Dining - Christmas Menu, Ahi, Khu Khu Eatery - Vegan Thai, East - Modern Asian Eatery)</span></li>
                                    </ul>
                                </li>
                                <li><span class="font-semibold text-gray-700">Day 16 (Dec 26, Departure):</span>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>Breakfast: <span class="meal-status booked">Prepaid at Horizon by SkyCity</span></li>
                                        <li>Lunch: <span class="meal-status tbd">TBD (Post-departure)</span></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <section id="dynamic-excursions-container" class="mb-12 p-8 bg-blue-50 content-card-bg rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Local Excursions & Notes</h2>
            
            <div id="excursions-Overview" class="excursion-content" data-excursion-for="Overview">
                <p class="text-gray-700 italic">No specific daily notes for the Tour Overview. Please select a city tab above to view local highlights and commentary.</p>
            </div>

            <div id="excursions-Christchurch" class="excursion-content" data-excursion-for="Christchurch">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700">
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Local Highlights (Day 1-3)</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Scheduled Activities:** Christchurch Tram Pass (Day 2) and Whale Watch Cruise Kaikoura (Day 3).</li>
                            <li>**Christchurch City:** Explore the Avon River on a punt, or visit the historic Arts Centre and Canterbury Museum.</li>
                            <li>**Alternative:** Visit the **International Antarctic Centre** or take the scenic **Christchurch Gondola** for city views.</li>
                            <li>**Dining & Culture:** Explore the **Riverside Market** for food or follow the city's extensive **Street Art Trail**.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Culture & History Commentary</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**TranzAlpine Journey (Day 4 start):** Considered one of the world's great train journeys, crossing the Southern Alps.</li>
                            <li>**Ōtautahi (Christchurch):** The Māori name for Christchurch means "the place of the altar" and refers to a settlement on the Avon River. It is the principal city of the **Ngāi Tahu** iwi (tribe).</li>
                            <li>**Cathedral City:** Christchurch was settled by the Canterbury Association in 1850 and is known as the "Most English" of New Zealand's cities due to its Gothic architecture and tradition.</li>
                            <li>**Kaikoura:** The name means "to eat crayfish" (`kai` - food/eat, `koura` - crayfish), reflecting its strong marine harvest traditions.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="excursions-LakeTekapo" class="excursion-content" data-excursion-for="LakeTekapo">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700">
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Local Highlights (Day 4)</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Scheduled Activity:** Summit Experience Stargazing Tour (Evening).</li>
                            <li>**Daytime:** Visit the iconic **Church of the Good Shepherd** and the **Mackenzie Sheep Dog Statue**.</li>
                            <li>**Alternative:** Relax at **Tekapo Springs** (hot pools/spa) or hike the **Mount Tahn Summit Track** for panoramic views.</li>
                            <li>**Dark Sky:** The area is part of the Aoraki Mackenzie International Dark Sky Reserve, offering unparalleled night sky views.</li>
                            </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Culture & History Commentary</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**En Route (Day 4):** Your guide will meet you at Arthur's Pass. Look out for the towering rock formations at **Castle Hill**.</li>
                            <li>**Mackenzie Country:** The region is named after Scottish shepherd **James Mackenzie**, an outlaw known for brilliant sheep rustling in the 1850s.</li>
                            <li>The lake's intense turquoise color comes from **fine rock-flour** (glacial grindings) suspended in the water.</li>
                            <li>**Stargazing:** The area is celebrated globally as one of the world's best places to view the Milky Way and the Magellanic Clouds, due to its protected dark skies.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="excursions-MountCook" class="excursion-content" data-excursion-for="MountCook">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700">
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Local Highlights (Day 5-6)</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Scheduled Activities:** Ultimate Helicopter Flight (Day 5) and Glacier Explorers Tour (Day 6).</li>
                            <li>**Hiking:** The **Hooker Valley Track** is a famous, relatively flat day walk offering stunning views of Mt Cook and crossing three swing bridges (allow 2-4 hours return).</li>
                            <li>**Short Walk:** The **Kea Point Track** is a shorter walk (approx. 1 hour return) from the campground to a glacial lake viewpoint.</li>
                            <li>**Culture:** Visit the **Sir Edmund Hillary Alpine Centre** to learn about the history of climbing and exploration in the Southern Alps.</li>
                            </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Culture & History Commentary</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Aoraki/Mt Cook:** The mountain has a dual name. **Aoraki** is the Māori name, meaning "Cloud Piercer," and holds deep mythological significance as an ancestor of the Ngāi Tahu tribe.</li>
                            <li>**Climbing History:** Sir Edmund Hillary, one of the first two men to climb Mount Everest, trained extensively on Aoraki, highlighting New Zealand's role in global mountaineering history.</li>
                            <li>**Wildlife:** Keep an eye out for the cheeky **Kea** (mountain parrots), the only alpine parrot in the world.</li>
                            <li>**Important:** The Glacier Explorers Tour involves a 1.5 km walk (20 minutes) to reach the boat launch site.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="excursions-Queenstown" class="excursion-content" data-excursion-for="Queenstown">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700">
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Local Highlights (Day 7-9)</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Scheduled Activities:** Walter Peak Gourmet Dinner (Day 7) and Central Otago Wine Tour (Day 8).</li>
                            <li>**Adventure:** Queenstown is the adventure capital. Consider **Bungy Jumping** (Kawarau Bridge or Nevis), **Skydiving**, or a **Shotover Jet Boat Ride** (optional activities).</li>
                            <li>**Scenic Views:** Ride the **Skyline Gondola** up Bob's Peak to enjoy the views and ride the **Luge**.</li>
                            <li>**Relaxation:** Book a session at the scenic **Onsen Hot Pools**.</li>
                            <li>**Wanaka Excursion (Day 9):** Visit **Arrowtown** for gold-mining history, and see the historic **Cardrona Hotel/Distillery**.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Culture & History Commentary</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Wakatipu Basin:** Māori legends describe the lake's unusual rhythmic rise and fall (a seiche) as the breathing of a giant sleeping giant, *Matau*.</li>
                            <li>**Crown Range:** One of New Zealand's highest alpine roads—drive carefully and enjoy the views.</li>
                            <li>**Gold Rush History:** Arrowtown was the heart of the 1860s Central Otago gold rush, attracting thousands of prospectors, including many Chinese miners whose restored settlement remains today.</li>
                            <li>**Day 8:** Is the mandatory **Guide Rest Day**. Independent activities are scheduled for this day.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="excursions-TeAnau" class="excursion-content" data-excursion-for="TeAnau">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700">
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Local Highlights (Day 10-11)</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Scheduled Activities:** Te Anau Glowworm Caves Tour (Day 10) and Milford Sound Nature Cruise (Day 11).</li>
                            <li>**Milford Road:** The drive to Milford Sound is spectacular; plan for multiple photo stops along the way (e.g., Mirror Lakes, Homer Tunnel).</li>
                            <li>**Hiking:** Experience a taste of a Great Walk by day hiking a section of the **Kepler Track** (e.g., Dock Bay or Brod Bay sections).</li>
                            <li>**Alternative:** See the highly recommended local film **Ata Whenua - Shadowland** at Fiordland Cinema about the remote national park.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Culture & History Commentary</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Fiordland National Park:** This is a UNESCO World Heritage Area, recognized for its dramatic glacier-carved fiords, temperate rainforests, and unique wildlife.</li>
                            <li>**Glowworm Caves:** Note that photography/video are not permitted inside the caves. Temperature is around $12^{\circ}C$.</li>
                            <li>**Milford Sound:** Rudyard Kipling famously called Milford Sound the 'Eighth Wonder of the World'. Its Māori name is **Piopiotahi**, meaning "a single piopio," referring to a now-extinct native bird.</li>
                            <li>**Cuisine:** Try local fare like venison, lobster, and seafood in Te Anau.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="excursions-Rotorua" class="excursion-content" data-excursion-for="Rotorua">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700">
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Local Highlights (Day 12-13)</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Scheduled Activities:** Redwoods Treewalk, Wai Ariki Hot Springs, and Te Pō Māori Cultural Experience + Hāngī Dinner (Day 13).</li>
                            <li>**Geothermal Activity:** Visit **Wai-O-Tapu Thermal Wonderland** to see the colorful hot springs and Lady Knox Geyser, or **Te Puia** to see the Põhutu Geyser and bubbling mud pools.</li>
                            <li>**Adventure:** Try **ZORB Rotorua** (rolling downhill in a giant inflatable ball) or take the **Skyline Gondola and Luge**.</li>
                            <li>**Culture:** Explore the **Whakarewarewa Living Māori Village** to see geothermal features and culture.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Culture & History Commentary</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Te Arawa Iwi:** Rotorua is the tribal home of the **Te Arawa** people, one of the primary Māori canoe groups that sailed from Hawaiki to New Zealand.</li>
                            <li>**Hāngī Dinner:** The traditional *Hāngī* dinner is cooked using heated rocks buried in a pit oven, a method integral to Māori hospitality (`manaakitanga`).</li>
                            <li>**Pacific Ring of Fire:** Rotorua is located within this volcanic area, explaining the geothermal activity.</li>
                            <li>**Spa Culture:** The thermal baths were originally utilized by Māori for healing and relaxation; the colonial-era government built the first Rotorua Sanatorium to promote the healing properties of the mineral water.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="excursions-Auckland" class="excursion-content" data-excursion-for="Auckland">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700">
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Local Highlights (Day 14-16)</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Day 15 (Independent):** Take a ferry to **Waiheke Island** for wineries and beaches, with optional activities like ziplining or a wine tour.</li>
                            <li>**City Highlights:** Visit the **Sky Tower** for dining or the SkyWalk/SkyJump.</li>
                            <li>**Waterfront:** Explore the **Viaduct Harbour** for dining and shopping, or take an **America's Cup sailing experience**.</li>
                            <li>**Culture:** Visit the **Auckland Museum** for daily Māori cultural performances or the **Auckland Art Gallery**.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-cyan-600">Culture & History Commentary</h4>
                        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
                            <li>**Tāmaki Makaurau:** The Māori name for Auckland, New Zealand's largest city, refers to the region's desirability and means "Tāmaki desired by many."</li>
                            <li>**City of Sails:** Auckland earned its nickname due to its two large harbours (Waitematā and Manukau) and the exceptionally high rate of boat ownership per capita.</li>
                            <li>**Volcanic Field:** The city is built upon an active monogenetic volcanic field consisting of about **50 volcanic cones** (like Rangitoto Island and Mount Eden).</li>
                            <li>**Sophistication Meets Nature:** The city is known for its blend of urban culture and accessible harbours/native bush.</li>
                        </ul>
                    </div>
                </div>
            </div>
            
        </section>


    </main>
    
    <div id="chatbot-wrapper">
        <div id="chat-window" class="">
            <iframe
                src="https://www.chatbase.co/chatbot-iframe/Fbt7luegVnFml1NzyNUol"
                width="100%"
                style="height: 100%; min-height: 450px; border: none;"
                frameborder="0"
                allowfullscreen
            ></iframe>
        </div>
        <button id="chat-toggle-btn" class="absolute bottom-0 right-0">
            <i class="fas fa-comment text-xl"></i>
        </button>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
        // Global array to hold all sphere objects for manipulation
        const spheres = [];
        const NUM_SPHERES = 14;
        
        // --- Speed Adjustment is here ---
        const SPEED_FACTOR = 0.035; // Increased overall magnitude of speed

        // 1. Scene Setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); 

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('threejs-background').appendChild(renderer.domElement);

        camera.position.z = 20;
        renderer.setClearColor(0x000000, 0); 

        // Handle window resizing
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // 2. Lighting Setup (Increased intensity for brighter, silvery look)
        const ambientLight = new THREE.AmbientLight(0xffffff, 1.2); // Increased intensity 
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 2.5); // Increased intensity
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);

        const fillLight = new THREE.DirectionalLight(0xaaaaaa, 1.0); // Increased intensity
        fillLight.position.set(-5, -5, -5);
        scene.add(fillLight);


        // 3. Sphere Creation (Geometry and Material)
        const geometry = new THREE.SphereGeometry(1, 32, 32);

        // Material for Translucent Silver (Reduced roughness for more shine)
        const silverTranslucentMaterial = new THREE.MeshPhysicalMaterial({
            color: 0xcccccc,          
            metalness: 1.0,           
            roughness: 0.05,          // Reduced to make it more mirror-like/silvery
            transparent: true,        
            // DECREASED OPACITY to allow more of the background to show through
            opacity: 0.55, 
            transmission: 0.9,        
            ior: 1.5,                 
            thickness: 0.5,           
        });

        // Function to generate speed within a narrow, consistent range (0.25 to 0.5)
        function generateNarrowSpeed() {
            // Generates a random number between 0.25 and 0.50
            return (Math.random() * 0.25 + 0.25);
        }

        // Function to create and position the 14 spheres
        function createSpheres() {
            for (let i = 0; i < NUM_SPHERES; i++) {
                const sphere = new THREE.Mesh(geometry, silverTranslucentMaterial);
                
                sphere.position.x = (Math.random() - 0.5) * 30;
                sphere.position.y = (Math.random() - 0.5) * 30;
                sphere.position.z = (Math.random() - 0.5) * 30;
                
                // Determine direction (+1 or -1) randomly
                const dirX = Math.random() < 0.5 ? -1 : 1;
                const dirY = Math.random() < 0.5 ? -1 : 1;
                const dirZ = Math.random() < 0.5 ? -1 : 1;

                // NARROW SPEED RANGE APPLIED: Consistent, faster movement
                sphere.speedX = generateNarrowSpeed() * SPEED_FACTOR * dirX; 
                sphere.speedY = generateNarrowSpeed() * SPEED_FACTOR * dirY;
                sphere.speedZ = generateNarrowSpeed() * SPEED_FACTOR * dirZ;
                
                scene.add(sphere);
                spheres.push(sphere);
            }
        }

        createSpheres();
        
        // 4. Animation Loop
        const boxSize = 25; 
        function animate() {
            requestAnimationFrame(animate);

            // Update sphere positions
            spheres.forEach(sphere => {
                sphere.position.x += sphere.speedX;
                sphere.position.y += sphere.speedY;
                sphere.position.z += sphere.speedZ;

                // Boundary checking
                if (sphere.position.x > boxSize || sphere.position.x < -boxSize) {
                    sphere.speedX *= -1;
                }
                if (sphere.position.y > boxSize || sphere.position.y < -boxSize) {
                    sphere.speedY *= -1;
                }
                if (sphere.position.z > boxSize || sphere.position.z < -boxSize) {
                    sphere.speedZ *= -1;
                }
                
                sphere.rotation.x += 0.001;
                sphere.rotation.y += 0.002;
            });

            renderer.render(scene, camera);
        }

        animate();

    </script>


    <script>
        // --- Map Schematic Data ---
        // Coordinates (X, Y) are normalized to an 800x700 viewBox for scaling.
        const mapData = [
            // --- STAYS ---
            { id: 'S1', type: 'Stay', city: 'Christchurch (CHCH)', day: 'Days 1-3', coord: { x: 500, y: 550 }, label: 'CHCH', color: '#dc2626', info: 'Hotel: Sudima Christchurch City (3 nights). Check-in: 11 Dec 2025 at 2:00 PM. Includes prepaid breakfast.' },
            { id: 'S2', type: 'Stay', city: 'Lake Tekapo', day: 'Day 4', coord: { x: 400, y: 400 }, label: 'TEKAPO', color: '#dc2626', info: 'Hotel: Grand Suites Lake Tekapo (1 night). Check-in: 14 Dec 2025 at 2:00 PM. Breakfast booked at The Godley Hotel (must arrive by 8:25 AM on Day 5).' },
            { id: 'S3', type: 'Stay', city: 'Mount Cook Village', day: 'Days 5-6', coord: { x: 300, y: 300 }, label: 'MT COOK', color: '#dc2626', info: 'Hotel: The Hermitage Hotel (2 nights). Check-in: 15 Dec 2025 at 3:00 PM. Includes Prepaid Fully Cooked Breakfast. Dinner reservations booked at Alpine Restaurant (6:00 PM Day 5, 7:00 PM Day 6).' },
            { id: 'S4', type: 'Stay', city: 'Queenstown (QTOWN)', day: 'Days 7-9', coord: { x: 200, y: 450 }, label: 'QTOWN', color: '#dc2626', info: 'Hotel: The Central Private Hotel by Naumi Hotels (3 nights). Check-in: 17 Dec 2025 at 3:00 PM. Includes Daily Continental Breakfast and complimentary happy hour (5-6pm).' },
            { id: 'S5', type: 'Stay', city: 'Te Anau', day: 'Days 10-11', coord: { x: 100, y: 550 }, label: 'TE ANAU', color: '#dc2626', info: 'Hotel: Fiordland Lakeview Motel & Apartments (2 nights). Check-in: 20 Dec 2025 at 2:00 PM. Breakfast booked at Distinction Te Anau Hotel (7:45 AM Dec 21 & 22).' },
            { id: 'S6', type: 'Stay', city: 'Rotorua', day: 'Days 12-13', coord: { x: 650, y: 250 }, label: 'ROTORUA', color: '#dc2626', info: 'Hotel: Pullman Hotel Rotorua (2 nights). Check-in: 22 Dec 2025 at 2:00 PM. Includes Prepaid Breakfast.' },
            { id: 'S7', type: 'Stay', city: 'Auckland (AKL)', day: 'Days 14-16', coord: { x: 600, y: 100 }, label: 'AKL', color: '#dc2626', info: 'Hotel: Horizon by SkyCity (2 nights). Check-in: 24 Dec 2025 at 3:00 PM. Includes Breakfast. Departure transfer scheduled for 7:20 AM on Day 16.' },

            // --- TRANSITS (Start ID, End ID, Description, Class) ---
            { id: 'T1', type: 'Transit', from: 'S1', to: 'S2', day: 'Day 4', info: 'Transit: Christchurch Station to Arthur\'s Pass via TranzAlpine Train (8:15 AM - 10:40 AM), followed by a 4-hour guided drive to Lake Tekapo.', class: 'transit-line', isRail: true, isRoad: true },
            { id: 'T2', type: 'Transit', from: 'S2', to: 'S3', day: 'Day 5', info: 'Transit: Scenic Drive from Lake Tekapo to Mount Cook Village (96 km, 1 hr 15 mins). Route passes Lake Pukaki.', class: 'transit-line' },
            { id: 'T3', type: 'Transit', from: 'S3', to: 'S4', day: 'Day 7', info: 'Transit: Scenic Drive from Mount Cook Village to Queenstown (264 km, 3.5 hrs). Route via Lindis Pass and Cromwell.', class: 'transit-line' },
            { id: 'T4', type: 'Transit', from: 'S4', to: 'S5', day: 'Day 10', info: 'Transit: Drive from Queenstown to Te Anau (172 km, 2.5 hrs). Route travels alongside Lake Wakatipu.', class: 'transit-line' },
            { id: 'T5', type: 'Transit', from: 'S5', to: 'S4', day: 'Day 12', info: 'Transit: Drive from Te Anau to Queenstown Airport (2.5 hrs). Guide delivery to airport by midday for onward flights.', class: 'transit-line' },
            { id: 'T6', type: 'Transit', from: 'S4', to: 'S6', day: 'Day 12', info: 'Transit: Domestic Flight (NZ634) from Queenstown Airport (15:05 PM) to Rotorua Airport (19:05 PM).', class: 'flight-line', isFlight: true },
            { id: 'T7', type: 'Transit', from: 'S6', to: 'S7', day: 'Day 14', info: 'Transit: Drive from Rotorua to Auckland (229 km, 3.5 hrs). Departure at 10:00 AM (or earlier) to arrive by 2:00 PM.', class: 'transit-line' },
            
            // --- EXCURSIONS (Associated Stay ID, Description, Point Coord, Color) ---
            { id: 'E1', type: 'Excursion', assocStay: 'S1', city: 'Kaikoura Cruise', day: 'Day 3', coord: { x: 550, y: 450 }, info: 'Excursion: Whale Watch Cruise Kaikoura (1:15 PM - 4:00 PM). Day trip from Christchurch (2.5 hr drive each way).', class: 'excursion-line' },
            { id: 'E3', type: 'Excursion', assocStay: 'S2', city: 'Stargazing', day: 'Day 4', coord: { x: 450, y: 350 }, info: 'Excursion: Summit Experience Stargazing Tour (10:00 PM - 11:45 PM). Use telescopes at the Dark Sky Reserve.', class: 'excursion-line' },
            { id: 'E4', type: 'Excursion', assocStay: 'S3', city: 'Heli Flight', day: 'Day 5', coord: { x: 250, y: 250 }, info: 'Excursion: Aoraki/Mt Cook Ultimate Helicopter Flight (2:00 PM - 2:50 PM). Includes snow landing on Tasman Glacier.', class: 'excursion-line' },
            { id: 'E5', type: 'Excursion', assocStay: 'S3', city: 'Glacier Explorers', day: 'Day 6', coord: { x: 350, y: 350 }, info: 'Excursion: Glacier Explorers Tour (11:30 AM - 2:15 PM). Boat trip on Tasman Glacial Lake to see icebergs.', class: 'excursion-line' },
            { id: 'E6', type: 'Excursion', assocStay: 'S4', city: 'Walter Peak Dinner', day: 'Day 7', coord: { x: 250, y: 500 }, info: 'Excursion: TSS Earnslaw Cruise and Walter Peak High Country Gourmet Dinner (5:00 PM - 9:00 PM).', class: 'excursion-line' },
            { id: 'E7', 'type': 'Excursion', assocStay: 'S4', city: 'Wine Tour', day: 'Day 8', coord: { x: 150, y: 500 }, info: 'Excursion: Central Otago Gourmet Food & Wine Tour (9:30 AM - 4:00 PM). Independent activity; Guide Rest Day.', class: 'excursion-line' },
            { id: 'E12', type: 'Excursion', assocStay: 'S4', city: 'Wanaka Excursion', day: 'Day 9', coord: { x: 150, y: 400 }, info: 'Excursion: Day Trip to Wanaka (1.5 hr drive each way). Stops suggested: Cardrona Hotel/Distillery, Wanaka Tree, or exploring the lakefront.', class: 'excursion-line' },
            { id: 'E8', type: 'Excursion', assocStay: 'S5', city: 'Glowworm Caves', day: 'Day 10', coord: { x: 150, y: 600 }, info: 'Excursion: Te Anau Glowworm Caves Tour (2:00 PM - 4:15 PM). Includes scenic cruise on Lake Te Anau.', class: 'excursion-line' },
            { id: 'E2', type: 'Excursion', assocStay: 'S5', city: 'Milford Cruise', day: 'Day 11', coord: { x: 50, y: 450 }, info: 'Excursion: Milford Sound Nature Cruise (1:45 PM - 3:30 PM). Day trip from Te Anau (2.5 hr drive each way).', class: 'excursion-line' },
            { id: 'E9', type: 'Excursion', assocStay: 'S6', city: 'Treewalk', day: 'Day 13', coord: { x: 700, y: 300 }, info: 'Excursion: Redwoods Treewalk. 700-meter long series of 28 suspension bridges, 20-metres above the forest floor.', class: 'excursion-line' },
            { id: 'E10', type: 'Excursion', assocStay: 'S6', city: 'Hot Springs', day: 'Day 13', coord: { x: 700, y: 200 }, info: 'Excursion: Restorative Journey (Wai Ariki Hot Springs and Spa) (2:00 PM - 4:00 PM). Two-hour therapeutic experience.', class: 'excursion-line' },
            { id: 'E11', type: 'Excursion', assocStay: 'S6', city: 'Hāngī Dinner', day: 'Day 13', coord: { x: 600, y: 300 }, info: 'Excursion: Te Pō Māori Cultural Experience + Hāngī Dinner (5:30 PM - 8:15 PM). Includes Hāngī buffet and cultural performance.', class: 'excursion-line' },
        ];

        // --- Map Drawing and Interactivity (REFACTORED TO D3.js) ---
        
        function updateInfoPanel(title, htmlContent) {
            const panel = document.getElementById('info-panel');
            const content = document.getElementById('info-content');
            
            panel.querySelector('h4').innerHTML = title;
            content.innerHTML = htmlContent;
        }

        function generateD3Map() {
            const svgContainer = d3.select("#map-svg-container");
            
            // 1. CLEAR: Remove only the previous SVG element if it exists
            svgContainer.select("#map-svg").remove();
            
            const svgNS = "http://www.w3.org/2000/svg";
            
            // 2. Create SVG element and append it
            const svg = svgContainer.append("svg")
                .attr("id", "map-svg")
                .attr("viewBox", "0 0 800 700"); 
            
            // Helper function to fetch the full stay object
            const getStayObject = (id) => mapData.find(d => d.id === id && d.type === 'Stay');

            // 3. Define Radial Gradients for 3D/Shine Effect
            const defs = svg.append("defs");

            // Red Stay Gradient (Softened Look)
            const stayGradient = defs.append("radialGradient")
                .attr("id", "stayGradient")
                .attr("cx", "30%").attr("cy", "30%").attr("r", "100%");
            
            stayGradient.append("stop").attr("offset", "0%").attr("stop-color", "#fca5a5"); // Red-300 (Lightest)
            stayGradient.append("stop").attr("offset", "100%").attr("stop-color", "#ef4444"); // Red-500 (Base)

            // Green Excursion Gradient (Softened Look)
            const excursionGradient = defs.append("radialGradient")
                .attr("id", "excursionGradient")
                .attr("cx", "30%").attr("cy", "30%").attr("r", "100%");

            excursionGradient.append("stop").attr("offset", "0%").attr("stop-color", "#6ee7b7"); // Emerald-300 (Lightest)
            excursionGradient.append("stop").attr("offset", "100%").attr("stop-color", "#34d399"); // Emerald-400 (Base)


            // 4. Filter data
            const stays = mapData.filter(d => d.type === 'Stay');
            const transits = mapData.filter(d => d.type === 'Transit');
            const excursions = mapData.filter(d => d.type === 'Excursion');
            

            // Helper function to attach click event (D3 binding)
            const attachClickEvents = (selection, d) => {
                let title, infoHtml;

                if (d.type === 'Stay') {
                    // UPDATED: Include Day numbers in title and body
                    title = `${d.city} Stay (${d.day})`;
                    infoHtml = `<p><strong>Days of Stay:</strong> ${d.day}</p><p>${d.info}</p>`;
                } else if (d.type === 'Transit') {
                    const startStay = getStayObject(d.from);
                    const endStay = getStayObject(d.to);
                    title = `${d.day}: ${d.isFlight ? 'Domestic Flight' : 'Transit'}`;
                    infoHtml = `<p><strong>Route:</strong> ${startStay.label} to ${endStay.label}</p><p>${d.info}</p>`;
                } else if (d.type === 'Excursion') {
                    title = `${d.day}: ${d.city}`;
                    infoHtml = `<p>${d.info}</p>`;
                }

                // CORRECTION: Add touchstart listener to ensure responsiveness on mobile/touch devices.
                // It calls the same logic as 'click'.
                selection.on('touchstart', function(event) {
                    event.preventDefault(); // Prevents default touch behavior (e.g., scrolling)
                    updateInfoPanel(title, infoHtml);
                });

                // Keep the 'click' listener for desktop support
                selection.on('click', () => {
                    updateInfoPanel(title, infoHtml);
                });
            };



            // 5. Draw Transits (Lines/Paths)
            svg.selectAll(".transit-element")
                .data(transits)
                .enter()
                .each(function(d) {
                    const startStay = getStayObject(d.from); 
                    const endStay = getStayObject(d.to);     

                    if (!startStay || !endStay) return; 

                    const startCoord = startStay.coord; 
                    const endCoord = endStay.coord;     
                    
                    let element;

                    if (d.isFlight) {
                        // T6: Queenstown -> Rotorua (Flight) - Uses Cubic Bézier (C) for wide separation
                        element = d3.select(this).append("path")
                            .attr("class", "flight-line");
                        // Control points: C(x1, y1, x2, y2)
                        const c1x = (startCoord.x + endCoord.x) / 2 - 200;
                        const c1y = (startCoord.y + endCoord.y) / 2 + 100;
                        element.attr('d', `M${startCoord.x} ${startCoord.y} C ${c1x} ${c1y}, ${c1x+400} ${c1y}, ${endCoord.x} ${endCoord.y}`);
                    } else if (d.id === 'T4' || d.id === 'T5') {
                        // T4 (S4 -> S5) & T5 (S5 -> S4) - Overlapping road segments. Use Quadratic Bézier (Q).
                        element = d3.select(this).append("path")
                            .attr("class", d.class);
                        
                        // Control points: S4(200, 450) <-> S5(100, 550)
                        if (d.id === 'T4') {
                             // S4 -> S5 (Inward curve: Q 180, 480)
                             element.attr('d', `M${startCoord.x},${startCoord.y} Q 180,480 ${endCoord.x},${endCoord.y}`);
                        } else {
                             // T5 (S5 -> S4) (Outward curve: Q 120, 520)
                            element.attr('d', `M${startCoord.x},${startCoord.y} Q 120,520 ${endCoord.x},${endCoord.y}`);
                        }
                    } else {
                        // Straight line for all other transits (T1, T2, T3, T7)
                        element = d3.select(this).append("line")
                            .attr("class", "transit-line")
                            .attr('x1', startCoord.x)
                            .attr('y1', startCoord.y)
                            .attr('x2', endCoord.x)
                            .attr('y2', endCoord.y);
                    }
                    
                    attachClickEvents(element, d);
                });

            // 6. Draw Excursions (Points & Lines)
            svg.selectAll(".excursion-element")
                .data(excursions)
                .enter()
                .each(function(d) {
                    const stayObject = getStayObject(d.assocStay);
                    if (!stayObject) return;
                    const stayCoord = stayObject.coord;

                    // Line from Stay Point to Excursion Point
                    const line = d3.select(this).append("line")
                        .attr("class", "excursion-line")
                        .attr('x1', stayCoord.x)
                        .attr('y1', stayCoord.y)
                        .attr('x2', d.coord.x)
                        .attr('y2', d.coord.y);
                    attachClickEvents(line, d);

                    // Excursion Point (Small Circle)
                    const point = d3.select(this).append("circle")
                        .attr("class", "excursion-point")
                        // Apply gradient fill
                        .attr("fill", "url(#excursionGradient)")
                        .attr('cx', d.coord.x)
                        .attr('cy', d.coord.y)
                        .attr('r', 8);
                    attachClickEvents(point, d);

                    // Add text label for the excursion
                    const text = d3.select(this).append("text")
                        .attr('x', d.coord.x)
                        .attr('y', d.coord.y + 15)
                        .attr('font-size', '14')
                        .attr('fill', '#059669')
                        .attr('text-anchor', 'middle')
                        .text(d.city);
                    attachClickEvents(text, d);
                });

            // 7. Draw Stays (Red Circles)
            stays.forEach(s => {
                const circle = svg.append("circle")
                    .attr("class", "stay-point")
                    // Apply gradient fill
                    .attr("fill", "url(#stayGradient)")
                    .attr('cx', s.coord.x)
                    .attr('cy', s.coord.y)
                    .attr('r', 12);
                attachClickEvents(circle, s);

                const text = svg.append("text")
                    .attr('x', s.coord.x)
                    .attr('y', s.coord.y - 15)
                    .attr('font-size', '16')
                    .attr('font-weight', 'bold')
                    .attr('fill', '#dc2626')
                    .attr('text-anchor', 'middle')
                    .text(s.label);
                attachClickEvents(text, s);
                
                // 8. Set default info panel to Christchurch (S1)
                if (s.id === 'S1') {
                     // UPDATED: Set default info with Day numbers
                     const defaultTitle = `${s.city} Stay (${s.day})`;
                     const defaultInfoHtml = `<p><strong>Days of Stay:</strong> ${s.day}</p><p>${s.info}</p>`;
                     updateInfoPanel(defaultTitle, defaultInfoHtml);
                }
            });
        }

        // --- Tab Functionality ---
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            const excursionContents = document.querySelectorAll('.excursion-content');
            const initialTargetId = "Overview";
            let mapGenerated = false;
            function setActiveTab(targetId) {
                // 1. Hide all itinerary contents
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });

                // 2. Hide all excursion contents
                excursionContents.forEach(content => {
                    content.classList.add('hidden');
                });

                // 3. Deactivate all buttons
                tabs.forEach(tab => {
                    tab.classList.remove('border-cyan-500', 'text-cyan-600', 'font-semibold');
                    tab.classList.add('border-transparent', 'text-gray-500', 'hover:text-cyan-600');
                });

                // 4. Show the target itinerary content
                const targetContent = document.querySelector(`[data-tab-content="${targetId}"]`);
                if (targetContent) {
                    targetContent.classList.remove('hidden');
                }

                // 5. Show the target excursion content (if one exists for the targetId)
                const targetExcursion = document.querySelector(`[data-excursion-for="${targetId}"]`);
                if (targetExcursion) {
                    targetExcursion.classList.remove('hidden');
                }

                // 6. Activate the button style
                const activeTab = document.querySelector(`[data-tab-target="${targetId}"]`);
                if (activeTab) {
                    activeTab.classList.add('border-cyan-500', 'text-cyan-600', 'font-semibold');
                    activeTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-cyan-600');
                }
                
                // 7. Generate map if TourMap is selected and it hasn't been generated yet
                if (targetId === "TourMap" && !mapGenerated) {
                    generateD3Map(); // Using the D3 generation function
                    mapGenerated = true;
                }
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetId = tab.dataset.tabTarget;
                    setActiveTab(targetId);
                });
            });

            // Initialize: set the first tab (Overview) as active on load
            setActiveTab(initialTargetId);
        });

        // --- Chatbot Toggle Functionality ---
        document.addEventListener('DOMContentLoaded', () => {
            const chatWindow = document.getElementById('chat-window');
            const chatToggleBtn = document.getElementById('chat-toggle-btn');
            
            // Set initial state to collapsed (not open)
            chatWindow.classList.remove('open'); 

            chatToggleBtn.addEventListener('click', () => {
                chatWindow.classList.toggle('open');
                // Optional: Change the button icon to an 'x' when open
                const icon = chatToggleBtn.querySelector('i');
                if (chatWindow.classList.contains('open')) {
                    icon.classList.remove('fa-comment');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-comment');
                }
            });
        });
    </script>

    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center text-sm">
            <p>&copy; 2025 New Zealand Guided Tours | Prepared for Kumar Rajan Group</p>
            <p>Guide: Mr. Gunther Hammer | Emergency Contact: +64 (0) 27 342 0953</p>
        </div>
    </footer>

</body>
</html>
